[system]
sql1=INSERT INTO t_trc_inf_call_1_min SELECT from_unixtime(AGGRTIME DIV 1000, 'yyyyMMddHHmm'),vAppid,vCmdid,iResult,count(1),avg(dProcessTime) \
FROM Msdk_server_Log_Route WHERE length(vAppid)<50 AND ((vAppid like "wx%") OR (vAppid regexp "^[0-9]+$")) \
GROUP BY vAppid,vCmdid,iResult COORDINATE BY unix_timestamp(dtEventTime, 'yyyy-MM-dd HH:mm:ss')*1000 WITH AGGR INTERVAL 60 SECONDS, \
\
INSERT INTO t_trc_spp_call_1_min SELECT from_unixtime(AGGRTIME DIV 1000, 'yyyyMMddHHmm'),vAppid,iCmd,iResult,count(1),avg(dProcessTime) \
FROM Msdk_server_Log_Spp WHERE length(vAppid)<50 AND ((vAppid like "wx%") OR (vAppid regexp "^[0-9]+$")) GROUP BY vAppid,iCmd,iResult \
COORDINATE BY unix_timestamp(dtEventTime, 'yyyy-MM-dd HH:mm:ss')*1000 WITH AGGR INTERVAL 60 SECONDS, \
\
INSERT INTO t_trc_inf_call_10_min SELECT from_unixtime(AGGRTIME DIV 1000, 'yyyyMMddHHmm'),vAppid,vCmdid,iResult,count(1),avg(dProcessTime) \
FROM Msdk_server_Log_Route WHERE length(vAppid)<50 AND ((vAppid like "wx%") OR (vAppid regexp "^[0-9]+$")) GROUP BY vAppid,vCmdid,iResult \
COORDINATE BY unix_timestamp(dtEventTime, 'yyyy-MM-dd HH:mm:ss')*1000 WITH AGGR INTERVAL 600 SECONDS, \
\
INSERT INTO t_trc_spp_call_10_min SELECT from_unixtime(AGGRTIME DIV 1000, 'yyyyMMddHHmm'),vAppid,iCmd,iResult,count(1),avg(dProcessTime) \
FROM Msdk_server_Log_Spp WHERE length(vAppid)<50 AND ((vAppid like "wx%") OR (vAppid regexp "^[0-9]+$")) GROUP BY vAppid,iCmd,iResult \
COORDINATE BY unix_timestamp(dtEventTime, 'yyyy-MM-dd HH:mm:ss')*1000 WITH AGGR INTERVAL 600 SECONDS

sql=WITH \
(SELECT vAppid, vOpenid, vRecvMsg, vSendMsg, iResult, iCmd, dtEventTime, \
parse_url(concat('http://?',vSendMsg),'QUERY','first')='0' queryFirst, \
if(nvl(vOpenid,'')='', if(nvl(parse_url(concat('http://?',vRecvMsg),'QUERY','openid'),'')='', \
parse_url(concat('http://?',vSendMsg),'QUERY','openid'), parse_url(concat('http://?',vRecvMsg),'QUERY','openid')), vOpenid) queryOpenid \
FROM Msdk_server_Log_Spp WHERE length(vAppid)<50 AND ((vAppid like "wx%") OR (vAppid regexp "^[0-9]+$"))) parseTbl, \
\
(SELECT vAppid, iResult, iCmd, dtEventTime, queryFirst, queryOpenid FROM parseTbl WHERE iResult=0 and (iCmd>=11 AND iCmd<=20)) filterTbl, \
\
(SELECT vAppid, from_unixtime((AGGRTIME DIV 1000), 'yyyy-MM-dd HH:00:00') timeH, \
from_unixtime((AGGRTIME DIV 1000), 'yyyy-MM-dd 00:00:00') timeD, \
concat_ws('-', 'h', from_unixtime((AGGRTIME DIV 1000), 'yyyy-MM-dd HH:00:00'), vAppid) kh, \
concat_ws('-', 'd', from_unixtime((AGGRTIME DIV 1000), 'yyyy-MM-dd 00:00:00'), vAppid) kd, \
sum(if(queryFirst='0',1,0)) regcnt, hllp(queryOpenid) b, from_unixtime(unix_timestamp()) ts FROM filterTbl GROUP BY vAppid \
COORDINATE BY unix_timestamp(dtEventTime, 'yyyy-MM-dd HH:mm:ss')*1000 WITH AGGR INTERVAL 300 SECONDS) aggrTbl, \
\
(SELECT aggrTbl.kh, timeH statTime, aggrTbl.vAppid, (aggrTbl.regcnt + nvl(dimtmp.regcnt, 0L)) regcnt, \
hllp_merge(aggrTbl.b, dimtmp.b) ball, aggrTbl.ts FROM aggrTbl left join dimtmp on aggrTbl.kh=dimtmp.k) jh, \
\
(SELECT aggrTbl.kd, timeD statTime, aggrTbl.vAppid, (aggrTbl.regcnt + nvl(dimtmp.regcnt, 0L)) regcnt, \
hllp_merge(aggrTbl.b, dimtmp.b) ball, aggrTbl.ts FROM aggrTbl left join dimtmp on aggrTbl.kd=dimtmp.k) jd, \
\
(SELECT k, regcnt, ball FROM (SELECT kh k, regcnt, ball FROM jh UNION ALL SELECT kd k, regcnt, ball FROM jd) jhd_utmp) jhd \
\
INSERT INTO t_rst_com_trc_cpu SELECT from_unixtime((AGGRTIME DIV 1000)+300) istatisday, vAppid, countd_hllp(queryOpenid SW), \
from_unixtime(unix_timestamp()) ts FROM filterTbl GROUP BY vAppid COORDINATE BY unix_timestamp(dtEventTime, 'yyyy-MM-dd HH:mm:ss')*1000 \
WITH AGGR INTERVAL 300 SECONDS WITH SW INTERVAL 1800 SECONDS, \
\
INSERT INTO dimtmp WITH k as KEY SELECT k, regcnt, ball FROM jhd, \
INSERT INTO t_rst_com_trc_userreg SELECT statTime, vAppid, regcnt, ts FROM jd WHERE regcnt>0, \
INSERT INTO t_rst_com_trc_userreg_hourdis SELECT statTime, vAppid, regcnt, ts FROM jh, \
INSERT INTO t_rst_com_trc_userlogin SELECT statTime, vAppid, hllp_get(ball), ts FROM jd WHERE regcnt>0, \
INSERT INTO t_rst_com_trc_userlogin_hourdis SELECT statTime, vAppid, hllp_get(ball), ts FROM jh

sql2=WITH \
(SELECT vAppid, vOpenid, vRecvMsg, vSendMsg, iResult, iCmd, dtEventTime, \
parse_url(concat('http://?',vSendMsg),'QUERY','first')='0' queryFirst, \
if(nvl(vOpenid,'')='', if(nvl(parse_url(concat('http://?',vRecvMsg),'QUERY','openid'),'')='', \
parse_url(concat('http://?',vSendMsg),'QUERY','openid'), parse_url(concat('http://?',vRecvMsg),'QUERY','openid')), vOpenid) queryOpenid \
FROM Msdk_server_Log_Spp WHERE length(vAppid)<50 AND ((vAppid like "wx%") OR (vAppid regexp "^[0-9]+$"))) parseTbl, \
\
(SELECT vAppid, iResult, iCmd, dtEventTime, queryFirst, queryOpenid FROM parseTbl WHERE iResult=0 and (iCmd>=11 AND iCmd<=20)) filterTbl \
\
INSERT INTO t_rst_com_trc_cpu SELECT from_unixtime((AGGRTIME DIV 1000)+300) istatisday, vAppid, countd_hllp(queryOpenid SW), \
from_unixtime(unix_timestamp()) ts FROM filterTbl GROUP BY vAppid COORDINATE BY unix_timestamp(dtEventTime, 'yyyy-MM-dd HH:mm:ss')*1000 \
WITH AGGR INTERVAL 300 SECONDS WITH SW INTERVAL 1800 SECONDS 

[tabledesc-1]
table.name=Msdk_server_Log_Route
table.type=stream
table.fields=ip,string,:interfaceName,string,:iEventId,bigint,:vVersion,string,:vFromIp,string,:vLocalIp,string,:iRequestType,int,:\
vAppid,string,:vOpenid,string,:vCmdid,string,:vL5_ip_port,string,:iPermission,int,:iResult,int,:dProcessTime,double,:vErrorMsg,string,:\
dtEventTime,string,:vUrl,string
table.zk.servers=tl-zk-td1:2181,tl-zk-td2:2181,tl-zk-td3:2181,tl-zk-td4:2181,tl-zk-td5:2181
table.zk.root=/meta_vip
table.topic=hy_msdk
table.interfaceId=Route
table.field.splitter=0x9

[tabledesc-2]
table.name=t_trc_inf_call_1_min
table.type=mysql
table.fields=statDate,bigint,:appId,string,:serviceId,int,:reCode,int,:callCount,int,:avgTime,double,

table.mysql.db.host=10.148.148.98
table.mysql.db.port=3323
table.mysql.db.name=TRC_Async
table.mysql.db.username=msdk
table.mysql.db.passwd=msdk@2013

[tabledesc-3]
table.name=Msdk_server_Log_Spp
table.type=stream
table.fields=ip,string,:interfaceName,string,:iFlow,bigint,:iSeq,bigint,:iCmd,int,:vClient_ip,string,:dProcessTime,int,:vServer_ip,string,:\
dtEventTime,string,:vAppid,string,:vOpenid,string,:vRecvMsg,string,:iResult,int,:vSendMsg,string,:iPlatCode,int
table.zk.servers=tl-zk-td1:2181,tl-zk-td2:2181,tl-zk-td3:2181,tl-zk-td4:2181,tl-zk-td5:2181
table.zk.root=/meta_vip
table.topic=hy_msdk
table.interfaceId=spp_server
table.field.splitter=0x9

[tabledesc-4]
table.name=t_trc_spp_call_1_min
table.type=mysql
table.fields=statDate,bigint,:appId,string,:serviceId,int,:reCode,int,:callCount,int,:avgTime,double,

table.mysql.db.host=10.148.148.98
table.mysql.db.port=3323
table.mysql.db.name=TRC_Async
table.mysql.db.username=msdk
table.mysql.db.passwd=msdk@2013


[tabledesc-5]
table.name=t_trc_inf_call_10_min
table.type=mysql
table.fields=statDate,bigint,:appId,string,:serviceId,int,:reCode,int,:callCount,int,:avgTime,double,

table.mysql.db.host=10.148.148.98
table.mysql.db.port=3323
table.mysql.db.name=TRC_Async
table.mysql.db.username=msdk
table.mysql.db.passwd=msdk@2013

[tabledesc-6]
table.name=t_trc_spp_call_10_min
table.type=mysql
table.fields=statDate,bigint,:appId,string,:serviceId,int,:reCode,int,:callCount,int,:avgTime,double,

table.mysql.db.host=10.148.148.98
table.mysql.db.port=3323
table.mysql.db.name=TRC_Async
table.mysql.db.username=msdk
table.mysql.db.passwd=msdk@2013

[tabledesc-dimtable-tde]
table.type=tde
table.name=dimtmp
table.fields=k,string,:regcnt,bigint,:b,binary,
table.field.key=k
table.binary.mode=true

table.tde.read.async=true
table.tde.write.async=false
table.tde.master=10.224.152.35:5198
table.tde.slave=10.129.131.235:5198
table.tde.groupname=tde_test
table.tde.tid=903
table.tde.timeout=5000

[tabledesc-dimtable-redis]
table.type=redis
table.name=dimtmp1
table.fields=k,string,:regcnt,bigint,:b,binary,
table.field.key=k
table.binary.mode=true

table.field.splitter=,
table.list.splitter=;
table.map.splitter=:

table.redis.host=127.0.0.1
table.redis.port=6379


[tabledesc-haina-1-t_rst_com_trc_cpu]
table.name=t_rst_com_trc_cpu
table.type=tpg
table.fields=istatisday,string,:vappid,string,:iusernum,bigint,:ts,string

table.tpg.db.host=pub-bi-tdw
table.tpg.db.port=5432
table.tpg.db.name=ieg_mgo
table.tpg.db.username=u_ieg_mgo
table.tpg.db.passwd=mgo@2013

[tabledesc-haina-2-t_rst_com_trc_userreg]
table.name=t_rst_com_trc_userreg
table.type=tpg
table.fields=istatisday,string,:vappid,string,:iusernum,bigint,:ts,string

table.tpg.db.host=pub-bi-tdw
table.tpg.db.port=5432
table.tpg.db.name=ieg_mgo
table.tpg.db.username=u_ieg_mgo
table.tpg.db.passwd=mgo@2013

[tabledesc-haina-3-t_rst_com_trc_userreg_hourdis]
table.name=t_rst_com_trc_userreg_hourdis
table.type=tpg
table.fields=istatisday,string,:vappid,string,:iusernum,bigint,:ts,string

table.tpg.db.host=pub-bi-tdw
table.tpg.db.port=5432
table.tpg.db.name=ieg_mgo
table.tpg.db.username=u_ieg_mgo
table.tpg.db.passwd=mgo@2013

[tabledesc-haina-4-t_rst_com_trc_userlogin]
table.name=t_rst_com_trc_userlogin
table.type=tpg
table.fields=istatisday,string,:vappid,string,:iusernum,bigint,:ts,string

table.tpg.db.host=pub-bi-tdw
table.tpg.db.port=5432
table.tpg.db.name=ieg_mgo
table.tpg.db.username=u_ieg_mgo
table.tpg.db.passwd=mgo@2013

[tabledesc-haina-5-t_rst_com_trc_userlogin_hourdis]
table.name=t_rst_com_trc_userlogin_hourdis
table.type=tpg
table.fields=istatisday,string,:vappid,string,:iusernum,bigint,:ts,string

table.tpg.db.host=pub-bi-tdw
table.tpg.db.port=5432
table.tpg.db.name=ieg_mgo
table.tpg.db.username=u_ieg_mgo
table.tpg.db.passwd=mgo@2013




