[system]

sql2= insert into __printtable select AGGRTIME DIV 1000, vopenid, count(uuid) from wefeng_dsl_playerregister_fht0 group by vopenid \
coordinate by unix_timestamp()*1000 with aggr interval 60 seconds

sql=\
with (select rand_i(5) bname, rand_i(1000) openid, unix_timestamp() agtime from __innertable(1)) wefeng_cr \
insert into __printtable select from_unixtime(AGGRTIME DIV 1000, 'yyyyMMddHHmm') vdatetime_m, bname vgame, \
packdim1.pack_id ipackage, count(openid) from (select bname, openid, agtime from wefeng_cr ) utbl \
left join packdim1 on hash(concat(utbl.openid, "-", utbl.bname)) % 1000 = packdim1.hash_id \
where bloom_contains(packdim1.bloom, hash(concat(utbl.openid, "-", utbl.bname))) group by bname, packdim1.pack_id \
coordinate by agtime*1000 with aggr interval 60 seconds \
\
with (select rand_i(5) bname, rand_i(1000) openid, unix_timestamp() agtime from __innertable(2)) wefeng_cr1 \
insert into __printtable select from_unixtime(AGGRTIME DIV 1000, 'yyyyMMddHHmm') vdatetime_m, bname vgame, \
packdim1.pack_id ipackage, count(openid) from (select bname, openid, agtime from wefeng_cr1 ) utbl1 \
left join packdim1 on hash(concat(utbl1.openid, "-", utbl1.bname)) % 1000 = packdim1.hash_id \
where bloom_contains(packdim1.bloom, hash(concat(utbl1.openid, "-", utbl1.bname))) group by bname, packdim1.pack_id \
coordinate by agtime*1000 with aggr interval 60 seconds \
\
with (select ibagid % 10 packid, hash(concat(openid, "-", vgame)) hashid from packstream) packtmp \
insert into packdim1 select AGGRTIME, hashid % 1000, packid, bloom(hashid) from packtmp \
group by hashid % 1000, packid coordinate by unix_timestamp()*1000+3000 with aggr interval 120 seconds 


sql1=with (select "1" bname, rand_i(100) openid, unix_timestamp() DIV 1000 agtime from __innertable(1)) wefeng_cr \
insert into __printtable select from_unixtime(AGGRTIME DIV 1000, 'yyyyMMddHHmm') vdatetime_m, bname vgame, \
packdim1.pack_id ipackage, count(openid) from (select bname, openid, agtime from wefeng_cr ) utbl \
left join packdim1 on hash(concat(utbl.openid, "-", utbl.bname)) % 1000 = packdim1.hash_id \
where bloom_contains(packdim1.bloom, hash(concat(utbl.openid, "-", utbl.bname))) group by bname, packdim1.pack_id \
coordinate by agtime*1000 with aggr interval 60 seconds \
\
with (select ibagid packid, hash(concat(openid, "-", vgame)) hashid from packstream) packtmp \
insert into packdim1 select AGGRTIME, hashid % 1000, packid, bloom(hashid) from packtmp \
group by hashid % 1000, packid coordinate by unix_timestamp()*1000+3000 with aggr interval 120 seconds

[tabledesc-7-PlayerRegister]
table.name=wefeng_dsl_playerregister_fht0
table.type=tube
table.fields=worldid,string,:__tablename,string,:vgamesvrid,string,:dteventtime,string,:isequence,bigint,:vgameappid,string,:vopenid,string,:platid,bigint,:clientversion,string,:systemsoftware,string,:systemhardware,string,:telecomoper,string,:network,string,:screenwidth,bigint,:screenhight,bigint,:density,double,:channel,bigint,:uuid,string,:cpuhardware,string,:memory,bigint,:glrender,string,:glversion,string,:deviceid,string,:vip,bigint,:viplv,bigint,
table.topic=hy_wefeng
table.interfaceId=PlayerRegister
table.tube.master=tl-vip-tube-master
table.tube.port=8609
table.field.splitter=|
splitter=|


[tabledesc-packstream]
table.name=packstream
table.type=tube
table.fields=openid,string,:vgame,string,:ibagid,int,:unixtime,bigint,
table.topic=ieg_idata
table.interfaceId=trace_user_bag
table.tube.master=tl-vip-tube-master
table.tube.port=8609
table.field.splitter=|
splitter=|


[tabledesc-res-packagecreaterole]
table.name=rtc_idata_package_createrole_m
table.fields=vdatetime_m,string,:vgame,string,:ipackage,int,:iminutenum,bigint,
table.type=tpg
table.tpg.db.host=ieg-bi-tdw.tencent-distribute.com
table.tpg.db.port=5432
table.tpg.db.name=ieg_idata
table.tpg.db.username=u_ieg_idata
table.tpg.db.passwd=u_ieg_idata@2014


[tabledesc-res-packdim]
table.name=packdim
table.fields=hash_id,int,:pack_id,int,:bloom,binary,
table.type=tpg
table.tpg.db.host=ieg-bi-tdw.tencent-distribute.com
table.tpg.db.port=5432
table.tpg.db.name=ieg_idata
table.tpg.db.username=u_ieg_idata
table.tpg.db.passwd=u_ieg_idata@2014
table.db.update.interval=30

[tabledesc-res-packdim1]
table.name=packdim1
table.fields=agtime,bigint,:hash_id,int,:pack_id,int,:bloom,binary,
table.type=tpg
table.tpg.db.host=ieg-bi-tdw.tencent-distribute.com
table.tpg.db.port=5432
table.tpg.db.name=ieg_idata
table.tpg.db.username=u_ieg_idata
table.tpg.db.passwd=u_ieg_idata@2014
table.db.update.interval=180
table.db.keyname=hash_id




