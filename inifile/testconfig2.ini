[system]
sql1=with \
(select g,x,xtype,collect_set(struct(y, ytype)) ylist from t group by g,x,xtype) tmp, \
(select g, mapmap(struct(x, xtype), ylist) mm from tmp group by g) tmp1 \
insert into dest1 select g, getallpath(mm) expand from tmp1

sql2=with \
(select g, x, xtype, mapmap(y, ytype) ymap, collect_set(y) ylist, AGGRTIME ttt from t group by g, x, xtype coordinate by time with aggr interval 60 seconds) tmp, \
(select g, map_merge(mapmap(x, xtype), mapmapmerge(ymap)) xymap, getallpath(mapmap(x, ylist)) path expand from tmp group by g coordinate by ttt with aggr interval 60 seconds) tmp1 \
insert into dest1 select g, path from tmp1


sql3=insert into dest1 select g, x, xtype, mapmap(y, ytype) ymap, collect_set(y) ylist, AGGRTIME ttt from t group by g, x, xtype coordinate by time with aggr interval 60 seconds

sql=with \
(select g, x, xtype, mapmap(y, ytype) ymap, collect_set(y) ylist, AGGRTIME ttt from t group by g, x, xtype coordinate by time with aggr interval 60 seconds) tmp, \
(select g, map_merge(mapmap(x, xtype), mapmapmerge(ymap)) xymap, getallpath(mapmap(x, ylist)) path expand from tmp group by g coordinate by ttt with aggr interval 60 seconds) tmp1 \
insert into dest select g, path from tmp1 where map_get(xymap, array_get(path,0))=0 and map_get(xymap, array_getlast(path))=2

[tabledesc-1]
table.name=t
table.fields=g,string,:x,string,:xtype,int,:y,string,:ytype,int,:time,bigint,
table.field.splitter=,
table.list.splitter=;
table.map.splitter=:

[tabledesc-2]
table.name=dest
table.binary.mode=false
table.fields=k,string,:cd,bigint,
table.field.splitter=,
table.list.splitter=;
table.map.splitter=:


[tabledesc-3]
table.name=dest1
table.binary.mode=false
table.fields=k,string,:cd,bigint,
table.field.splitter=,
table.list.splitter=;
table.map.splitter=:


