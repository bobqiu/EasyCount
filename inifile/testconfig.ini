[system]
sql1=INSERT INTO dest SELECT a, b, AGGRTIME DIV 1000, count(c), collect_set(c), sum(c), count(c accu), countd1(c SW), CAST (avg(c+d) AS FLOAT), avg(c ACCU), avg(c SW) FROM xxx GROUP BY a, b COORDINATE BY e*1000 WITH AGGR INTERVAL 5 SECONDS WITH ACCU INTERVAL 30 SECONDS WITH SW INTERVAL 60 SECONDS HAVING sum(d)>15
sql2=INSERT INTO ieg_bd_dl_result SELECT from_unixtime(AGGRTIME DIV 1000, 'yyyyMMddHHmm'),custom_id,count(1),sum(complete),avg(total_filesize / total_duration),collect_set(CASE complete WHEN "1" THEN uin ELSE null END),collect_set(CASE complete WHEN "0" THEN uin ELSE null END) FROM ieg_bd_download GROUP BY custom_id COORDINATE BY unix_timestamp(time_t, 'yyyyMMddHHmmss')*1000 WITH AGGR INTERVAL 60 SECONDS
sql3=INSERT INTO ieg_yunfu_cgilog_result SELECT from_unixtime(AGGRTIME DIV 1000, 'yyyyMMddHHmm'),vCgiName,vCmdName,count(1),sum(CASE CAST (iErrorCode AS INT) WHEN 0 THEN 0 ELSE 1 END),avg(dtEndTime-dtStartTime),avg(CASE CAST (iErrorCode AS INT) WHEN 0 THEN dtEndTime-dtStartTime ELSE NULL END ) FROM ieg_yunfu_cgilog GROUP BY vCgiName,vCmdName COORDINATE BY unix_timestamp(dtTime, 'yyyy-MM-dd HH:mm:ss')*1000 WITH AGGR INTERVAL 60 SECONDS
sql4=INSERT INTO dest SELECT xxx.a, xxx.b, xxx.c, xxx.d, e, f, dim.a, dim.b, dim.c, dim1.a, dim1.b, dim1.c FROM xxx xxx LEFT JOIN dim, dim1 ON xxx.a=dim.a AND xxx.b=dim1.b
sql5=INSERT INTO dest SELECT map_keys(map(xxx.a, xxx.b,xxx.c, xxx.d)), array(xxx.c, xxx.d), struct(e, f), dim.a, dim.b, dim.c, dim1.a, dim1.b, dim1.c FROM xxx xxx LEFT JOIN dim, dim1 ON xxx.a=dim.a AND xxx.b=dim1.b
sql6=insert into dest select g, collect_set(dim) from (select g, map(array(a, b) , countd(xxx)) dim from xxx group by g, a, b) group by g
sql7=insert into dest select g, map(concat(a, "-", b) , countd(d)) dim from xxx group by g, a, b
sql8=insert into dest select g, array_get(collect_set(dim),"14-22") from (select g, concat(a, "-", b, ":", countd(d)) dim from xxx group by g, a, b) tmp group by g
sql9=insert into dest select g, collect_set(dim), array_get(collect_set(dim),"14-22") from (select g, map(concat(a, "-", b), countd(d)) dim from xxx group by g, a, b) tmp group by g
sql10=insert into dest select g, mapmap(a,map(b,c)) from xxx group by g
sql11=with (select g, mapmap(a,map(b,c)) mm from xxx group by g) tmp insert into dest select g, mm from tmp
sql12=with (select g, 1 idx, map(a, array(count(c), countd(c))) dim from xxx group by g,a) t1, (select g, 2 idx, map(a, array(count(c), countd(c))) dim from yyy group by g,a) t2, (select g, 3 idx, map(a, array(count(c), countd(c))) dim from zzz group by g,a) t3, (select g, idx, dim from (select g, idx, dim from t1 union all select g, idx, dim from t2 union all select g, idx, dim from t3) ttt) t4 insert into dest select g, mapmap(idx, dim) from t4 group by g
sql13=\
with \
(select g, 1 idx, mapmap(a,ar) dim from (select g, a, array(count(c), countd(c)) ar from xxx group by g,a) tmp1 group by g) t1, \
(select g, 2 idx, mapmap(a,ar) dim from (select g, a, array(count(c), countd(c)) ar from yyy group by g,a) tmp2 group by g) t2, \
(select g, 3 idx, mapmap(a,ar) dim from (select g, a, array(count(c), countd(c)) ar from zzz group by g,a) tmp3 group by g) t3, \
(select g, idx, dim from (select g, idx, dim from t1 union all select g, idx, dim from t2 union all select g, idx, dim from t3) ttt) t4 \
insert into dest select g, mapmap(idx, dim) from t4 group by g

sql=with (select array(1,2,3) list, cast (rand()*100 as int) xx from __innertable(1000) ) xxx_test \
insert into __printtable select cast(1 as bigint), map(0,1), foreach(x in list generate $x+10), \
execute(define x as int default 0, y as int default 1 {x:=10;y:=1000;for($x>0 x:=$x-1;y:=$x+$y)} emit $x+$y), \
execute(define x as int default 0, y as int default 1 {x:=10;y:=1000;for($x>0 x:=$x-1;if($x%2=0 x:=$x-1);y:=$x+$y)} emit $x+$y), \
execute(define x as int default 0, y as int default 1, m as map<int,int> {x:=10;y:=1000;for($x>0 x:=$x-1;y:=$y+1;m:=map_put($m,$x,$y))} emit $m) \
from xxx_test 





[tabledesc-1]
table.name=xxx
table.fields=g,string,:a,string,:b,int,:c,string,:d,string,:e,bigint,:f,string,:list,array<int>
table.field.splitter=,
table.list.splitter=;
table.map.splitter=:

[tabledesc-111]
table.name=yyy
table.fields=g,string,:a,string,:b,int,:c,string,:d,string,:e,bigint,:f,string,
table.field.splitter=,
table.list.splitter=;
table.map.splitter=:

[tabledesc-122]
table.name=zzz
table.fields=g,string,:a,string,:b,int,:c,string,:d,string,:e,bigint,:f,string,
table.field.splitter=,
table.list.splitter=;
table.map.splitter=:

table.zk.servers=
table.zk.root=
table.topic=
table.interfaceId=


[tabledesc-2]
table.name=dest
table.binary.mode=false
table.fields=g,string,:m,map<string\\,string>,
table.field.splitter=,
table.list.splitter=;
table.map.splitter=:


[tabledesc-dimtable]
table.type=mem
table.name=dim
table.fields=a,string,:b,string,:c,string
table.field.key=a
table.mem.data.file=dimtable.data

table.field.splitter=,
table.list.splitter=;
table.map.splitter=:

[tabledesc-dimtable1]
table.type=mem
table.name=dim1
table.fields=a,string,:b,string,:c,string
table.field.key=b
table.mem.data.file=dimtable.data1

table.field.splitter=,
table.list.splitter=;
table.map.splitter=:



table.zk.servers=
table.zk.root=
table.topic=
table.interfaceId=

[tabledesc-3]
table.name=ieg_bd_download
table.fields=time_t,string,:custom_id,string,:total_filesize,bigint,:uin,string,:speed_type,string,:total_duration,bigint,:province,string,:complete,string,:isp,string,
table.zk.servers=tl-zk-td1:2181,tl-zk-td2:2181,tl-zk-td3:2181,tl-zk-td4:2181,tl-zk-td5:2181
table.zk.root=/meta
table.topic=ieg_bd
table.interfaceId=bd_download
table.field.splitter=;

[tabledesc-4]
table.name=ieg_bd_dl_result
table.fields=a,string,:b,string,:c,int,:d,int,:e,bigint,:f,string,
table.zk.servers=tl-zk-test1:2181
table.zk.root=/meta
table.topic=ieg_bd_test
table.interfaceId=1



[tabledesc-11]
table.name=ieg_yunfu_apachelog
table.fields=ip,string,:dtTime,STRING:iUseTime,BIGINT:vClientIP,STRING:vServerIp,STRING:vServerName,STRING:vMethod,STRING:vURL,BIGINT:iStatus,BIGINT
table.zk.servers=tl-zk-td1:2181,tl-zk-td2:2181,tl-zk-td3:2181,tl-zk-td4:2181,tl-zk-td5:2181
table.zk.root=/meta
table.topic=hy_osrd
table.interfaceId=apachelog
table.field.splitter=|

[tabledesc-21]
table.name=ieg_yunfu_cgilog
table.fields=ip,string,:vCgiName,STRING:vCmdName,STRING:vServerIp,STRING:vClientIP,STRING:dtStartTime,STRING:dtEndTime,STRING:iUseTime,BIGINT:iErrorCode,BIGINT
table.zk.servers=tl-zk-td1:2181,tl-zk-td2:2181,tl-zk-td3:2181,tl-zk-td4:2181,tl-zk-td5:2181
table.zk.root=/meta
table.topic=hy_osrd
table.interfaceId=cgilog
table.field.splitter=|

[tabledesc-31]
table.name=ieg_yunfu_apimsglog
table.fields=ip,string,:record_time,BIGINT:cmd,STRING:host_ip,STRING:port,BIGINT:client_ip,STRING:used_time,BIGINT:result,BIGINT
table.zk.servers=tl-zk-td1:2181,tl-zk-td2:2181,tl-zk-td3:2181,tl-zk-td4:2181,tl-zk-td5:2181
table.zk.root=/meta
table.topic=hy_osrd
table.interfaceId=server_api_msg_log
table.field.splitter=|

[tabledesc-1-res]
table.name=ieg_yunfu_apachelog_result
table.fields=dtTime,STRING
table.zk.servers=tl-zk-test1:2181,tl-zk-test2:2181,tl-zk-test3:2181,tl-zk-test4:2181,tl-zk-test5:2181
table.zk.root=/meta
table.topic=hy_osrd_result
table.interfaceId=apachelog
table.field.splitter=|

[tabledesc-2-res]
table.name=ieg_yunfu_cgilog_result
table.fields=dtTime,STRING
table.zk.servers=tl-zk-test1:2181,tl-zk-test2:2181,tl-zk-test3:2181,tl-zk-test4:2181,tl-zk-test5:2181
table.zk.root=/meta
table.topic=hy_osrd_result
table.interfaceId=cgilog
table.field.splitter=|

[tabledesc-3-res]
table.name=ieg_yunfu_apimsglog_result
table.fields=dtTime,STRING
table.zk.servers=tl-zk-test1:2181,tl-zk-test2:2181,tl-zk-test3:2181,tl-zk-test4:2181,tl-zk-test5:2181
table.zk.root=/meta
table.topic=hy_osrd_result
table.interfaceId=server_api_msg_log
table.field.splitter=|
