[system]
sql=INSERT INTO tbRunStatus5min_CGI SELECT vCgiName, vCmdName, count(1) iTotal, sum(CASE iErrorCode WHEN 0L THEN 0 ELSE 1 END) iTotalerror, CAST (avg(iUseTime) AS INT) iDelaystamp, coalesce(CAST (avg(CASE iErrorCode WHEN 0L THEN NULL ELSE iUseTime END ) AS INT),0) iError_delay_stamp, from_unixtime(AGGRTIME DIV 1000, 'yyyy-MM-dd HH:mm:ss') dtStartTime, from_unixtime((AGGRTIME DIV 1000) + 300, 'yyyy-MM-dd HH:mm:ss') dtEndTime,from_unixtime(unix_timestamp(),'yyyy-MM-dd HH:mm:ss') dtStatTime FROM ieg_yunfu_cgilog GROUP BY vCgiName, vCmdName COORDINATE BY unix_timestamp(dtEndTime, 'yyyy-MM-dd HH:mm:ss')*1000 WITH AGGR INTERVAL 300 SECONDS, \
\
INSERT INTO tbErrorStatus5min_CGI SELECT vCgiName, vCmdName, CAST(iErrorCode as INT), count(1) iCount, CAST (avg(iUseTime) AS INT) iDelaystamp, from_unixtime(AGGRTIME DIV 1000, 'yyyy-MM-dd HH:mm:ss') dtStartTime, from_unixtime((AGGRTIME DIV 1000) + 300, 'yyyy-MM-dd HH:mm:ss') dtEndTime,from_unixtime(unix_timestamp(),'yyyy-MM-dd HH:mm:ss') dtStatTime FROM ieg_yunfu_cgilog GROUP BY vCgiName, vCmdName, iErrorCode COORDINATE BY unix_timestamp(dtEndTime, 'yyyy-MM-dd HH:mm:ss')*1000 WITH AGGR INTERVAL 300 SECONDS, \
\
INSERT INTO tbRunStatus5min_Apache SELECT vServerName vCgiName, vServerIp vCmdName, count(1) iTotal, sum(CASE iStatus WHEN 200L THEN 0 ELSE 1 END) iTotalerror, CAST (avg(iUseTime) AS INT) iDelaystamp, coalesce(CAST (avg(CASE iStatus WHEN 200L THEN NULL ELSE iUseTime END ) AS INT),0) iError_delay_stamp, from_unixtime(AGGRTIME DIV 1000, 'yyyy-MM-dd HH:mm:ss') dtStartTime, from_unixtime((AGGRTIME DIV 1000) + 300, 'yyyy-MM-dd HH:mm:ss') dtEndTime, from_unixtime(unix_timestamp(),'yyyy-MM-dd HH:mm:ss') dtStatTime FROM ieg_yunfu_apachelog GROUP BY vServerName, vServerIp COORDINATE BY unix_timestamp(dtTime, 'yyyy-MM-dd HH:mm:ss')*1000 WITH AGGR INTERVAL 300 SECONDS, \
\
INSERT INTO tbErrorStatus5min_Apache SELECT vServerName vCgiName, vServerIp vCmdName, cast (iStatus as INT), count(1) iCount, CAST (avg(iUseTime) AS INT) iDelaystamp, from_unixtime(AGGRTIME DIV 1000, 'yyyy-MM-dd HH:mm:ss') dtStartTime, from_unixtime((AGGRTIME DIV 1000) + 300, 'yyyy-MM-dd HH:mm:ss') dtEndTime, from_unixtime(unix_timestamp(),'yyyy-MM-dd HH:mm:ss') dtStatTime FROM ieg_yunfu_apachelog GROUP BY vServerName, vServerIp, iStatus COORDINATE BY unix_timestamp(dtTime, 'yyyy-MM-dd HH:mm:ss')*1000 WITH AGGR INTERVAL 300 SECONDS, \
\
INSERT INTO tbRunStatus5min_Server SELECT 0 iAppId, host_ip vServerIP, port iPort, cmd vCmdName, count(1) iTotal, sum(CASE result WHEN 0L THEN 0 ELSE 1 END) iTotalerror, CAST (avg(used_time) AS INT) iDelaystamp, coalesce(CAST (avg(CASE result WHEN 0L THEN NULL ELSE used_time END ) AS INT),0) iError_delay_stamp, from_unixtime((AGGRTIME DIV 1000)+300, 'yyyy-MM-dd HH:mm:ss') dtStatTime, cast (unix_timestamp() as INT) iQueryTS FROM ieg_yunfu_apimsglog GROUP BY host_ip, port, cmd COORDINATE BY record_time*1000 WITH AGGR INTERVAL 300 SECONDS, \
\
INSERT INTO tbErrorStatus5min_Server SELECT 0 iAppId, host_ip vServerIP, port iPort, cmd vCmdName, cast(result as INT) iErrorCode, count(1) iCount, CAST (avg(used_time) AS INT) iDelaystamp, from_unixtime((AGGRTIME DIV 1000) + 300, 'yyyy-MM-dd HH:mm:ss') dtStatTime, cast(unix_timestamp() as INT) iQueryTS FROM ieg_yunfu_apimsglog GROUP BY host_ip, port, cmd, result COORDINATE BY record_time*1000 WITH AGGR INTERVAL 300 SECONDS

[tabledesc-1]
table.name=ieg_yunfu_apachelog
table.fields=ip,string,:dtTime,STRING:iUseTime,BIGINT:vClientIP,STRING:vServerIp,STRING:vServerName,STRING:vMethod,STRING:vURL,BIGINT:iStatus,BIGINT
table.zk.servers=tl-zk-td1:2181,tl-zk-td2:2181,tl-zk-td3:2181,tl-zk-td4:2181,tl-zk-td5:2181
table.zk.root=/meta
table.topic=hy_osrd
table.interfaceId=apachelog
table.field.splitter=|

[tabledesc-2]
table.name=ieg_yunfu_cgilog
table.fields=ip,string,:vCgiName,STRING:vCmdName,STRING:vServerIp,STRING:vClientIP,STRING:dtStartTime,string:dtEndTime,string:iUseTime,BIGINT:iErrorCode,BIGINT
table.zk.servers=tl-zk-td1:2181,tl-zk-td2:2181,tl-zk-td3:2181,tl-zk-td4:2181,tl-zk-td5:2181
table.zk.root=/meta
table.topic=hy_osrd
table.interfaceId=cgilog
table.field.splitter=|

[tabledesc-3]
table.name=ieg_yunfu_apimsglog
table.fields=ip,string,:record_time,BIGINT:cmd,STRING:host_ip,STRING:port,STRING:client_ip,STRING:used_time,BIGINT:result,BIGINT
table.zk.servers=tl-zk-td1:2181,tl-zk-td2:2181,tl-zk-td3:2181,tl-zk-td4:2181,tl-zk-td5:2181
table.zk.root=/meta
table.topic=hy_osrd
table.interfaceId=server_api_msg_log
table.field.splitter=|

[tabledesc-1-res1]
table.name=tbRunStatus5min_CGI
table.fields=vCgiName,string,:vCmdName,string,:iTotal,bigint,:iTotalerror,bigint,:iDelaystamp,int,:iError_delay_stamp,int,:dtStartTime,string,:dtEndTime,string,:dtStatTime,string,
table.type=mysql
table.mysql.db.host=10.132.24.70
table.mysql.db.port=3306
table.mysql.db.name=dbCapMgr4TRC
table.mysql.db.username=cap_admin
table.mysql.db.passwd=cap_admin@vip

[tabledesc-1-res2]
table.name=tbErrorStatus5min_CGI
table.fields=vCgiName,string,:vCmdName,string,:iErrorCode,int,:iCount,bigint,:iDelaystamp,int,:dtStartTime,string,:dtEndTime,string,:dtStatTime,string,
table.type=mysql
table.mysql.db.host=10.132.24.70
table.mysql.db.port=3306
table.mysql.db.name=dbCapMgr4TRC
table.mysql.db.username=cap_admin
table.mysql.db.passwd=cap_admin@vip

[tabledesc-2-res1]
table.name=tbRunStatus5min_Apache
table.fields=vCgiName,string,:vCmdName,string,:iTotal,bigint,:iTotalerror,bigint,:iDelaystamp,int,:iError_delay_stamp,int,:dtStartTime,string,:dtEndTime,string,:dtStatTime,string,
table.type=mysql
table.mysql.db.host=10.132.24.70
table.mysql.db.port=3306
table.mysql.db.name=dbCapMgr4TRC
table.mysql.db.username=cap_admin
table.mysql.db.passwd=cap_admin@vip

[tabledesc-2-res2]
table.name=tbErrorStatus5min_Apache
table.fields=vCgiName,string,:vCmdName,string,:iErrorCode,int,:iCount,bigint,:iDelaystamp,int,:dtStartTime,string,:dtEndTime,string,:dtStatTime,string,
table.type=mysql
table.mysql.db.host=10.132.24.70
table.mysql.db.port=3306
table.mysql.db.name=dbCapMgr4TRC
table.mysql.db.username=cap_admin
table.mysql.db.passwd=cap_admin@vip

[tabledesc-3-res1]
table.name=tbRunStatus5min_Server
table.fields=iAppId,int,:vServerIP,string,:iPort,string,:vCmdName,string,:iTotal,bigint,:iTotalerror,bigint,:iDelaystamp,int,:iError_delay_stamp,int,:dtStatTime,string,:iQueryTS,int,
table.type=mysql
table.mysql.db.host=10.132.24.70
table.mysql.db.port=3306
table.mysql.db.name=dbCapMgr4TRC
table.mysql.db.username=cap_admin
table.mysql.db.passwd=cap_admin@vip

[tabledesc-3-res2]
table.name=tbErrorStatus5min_Server
table.fields=iAppId,int,:vServerIP,string,:iPort,string,:vCmdName,string,:iErrorCode,int,:iCount,bigint,:iDelaystamp,int,:dtStatTime,string,:iQueryTS,int,
table.type=mysql
table.mysql.db.host=10.132.24.70
table.mysql.db.port=3306
table.mysql.db.name=dbCapMgr4TRC
table.mysql.db.username=cap_admin
table.mysql.db.passwd=cap_admin@vip






