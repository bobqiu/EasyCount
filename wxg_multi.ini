[system]

sql=INSERT INTO weixin_res_meta SELECT from_unixtime(AGGRTIME DIV 1000, 'yyyyMMdd'), Funid_, ConnectType_, ClientVersion_, \
Device_, country_id, province_id, city_id, isp_id, NetType_, idc, if(bdelay=1, timeLevel, 0) timeLevel, retType, errCode, \
COUNT(1) cnt, avg(if(bdelay=1, CostTime_, 0)) \
FROM (SELECT Funid_, ConnectType_, concat('0x', hex(ClientVersion_)) ClientVersion_, Device_, NetType_, ExpandCol1_ idc, \
(case when CostTime_<100 then 1 when CostTime_<500 then 2 when CostTime_<1000 then 3 when CostTime_<2000 then 4 \
when CostTime_<3000 then 5 when CostTime_<4000 then 6 when CostTime_<5000 then 7 when CostTime_<10000 then 8 \
when CostTime_<20000 then 9 when CostTime_<120000 then 10 else 11 end) timeLevel, \
if((IfSuccess_ >= 0 and IfSuccess_ <= 6), IfSuccess_, -1) retType, ErrCode_ errCode, \
if((IfSuccess_ = 0 and ErrCode_ = 0 and EndTs_ - StartTs_ - CostTime_ >= -5 and EndTs_ - StartTs_ - CostTime_ <= 5 \
and CostTime_ >= 50 and CostTime_ <= 60000), 1, 0) bdelay, \
TimeStamp_, CostTime_, CAST ((ClientIP_ - ClientIP_ % 256) AS STRING) AS ipstr \
FROM log_10410 WHERE (Device_ <> 2 or ClientVersion_ > 604176384) and (SvrIp_ = 0 or SvrIp_ > 16777216) and \
(ConnectType_ = 0 or ConnectType_ = 1) \
) ttt LEFT JOIN ip_table ON ttt.ipstr = ip_table.ipint GROUP BY Funid_, \
ConnectType_, ClientVersion_, Device_, country_id, province_id, city_id, isp_id, NetType_, idc, if(bdelay=1, timeLevel, 0), retType, errCode \
COORDINATE BY TimeStamp_*1000 WITH AGGR INTERVAL 1200 SECONDS





[tabledesc-log_10410]
table.name=log_10410
table.type=stream
table.fields=LogID_,bigint,:ProtocolVersion_,bigint,:Uin_,bigint,:IfSuccess_,bigint,:Device_,bigint,:ClientVersion_,bigint,:\
ClientIP_,bigint,:AgentIP_,bigint,:TimeStamp_,bigint,:ExpandCol1_,bigint,:ExpandCol2_,bigint,:SvrIp_,bigint,:SvrPort_,bigint,:\
CostTime_,bigint,:NetType_,bigint,:IpType_,bigint,:Alivetime_,bigint,:ConnectType_,bigint,:Funid_,bigint,:ErrCode_,bigint,:\
SignalStrength_,bigint,:UploadSize_,bigint,:DownloadSize_,bigint,:RetryCount_,bigint,:CostTimeref_,bigint,:\
StartTs_,bigint,:EndTs_,bigint,:ProcessId_,bigint,
table.zk.servers=xx-xx-xx1:2181,xx-xx-xx2:2181,xx-xx-xx3:2181,xx-xx-xx4:2181,xx-xx-xx5:2181
table.zk.root=/xxxx_xxxxxx
table.topic=cdg_xxxxxxx
table.interfaceId=log_10410

table.field.splitter=,
table.list.splitter=;
table.map.splitter=:

[tabledesc-log_10133]
table.name=log_10133
table.type=stream
table.fields=LogID_,BIGINT,:ProtocolVersion_,BIGINT,:Uin_,BIGINT,:IfSuccess_,BIGINT,:Device_,BIGINT,:ClientVersion_,BIGINT,:\
ClientIP_,BIGINT,:AgentIP_,BIGINT,:TimeStamp_,BIGINT,:ExpandCol1_,BIGINT,:ExpandCol2_,BIGINT,:SvrIp_,BIGINT,:\
SvrPort_,BIGINT,:BeginTime_,BIGINT,:EndTime_,BIGINT,:CostTime_,BIGINT,:NetType_,BIGINT,:IpType_,BIGINT,:ConnectType_,BIGINT,:\
IsFirst_,BIGINT,:ErrCode_,BIGINT,:SignalStrength_,BIGINT,:IspCode_,BIGINT,:IspName_,STRING,:NewNetType_,BIGINT,:SubNetType_,BIGINT,:\
NetExtraInfo_,BIGINT
table.zk.servers=xx-xx-xx1:2181,xx-xx-xx2:2181,xx-xx-xx3:2181,xx-xx-xx4:2181,xx-xx-xx5:2181
table.zk.root=/xxxx_xxxxxx
table.topic=cdg_xxxxxxx
table.interfaceId=log_10133

table.field.splitter=,
table.list.splitter=;
table.map.splitter=:

[tabledesc-log_10393]
table.name=log_10393
table.type=stream
table.fields=LogID_,BIGINT,:ProtocolVersion_,BIGINT,:Uin_,BIGINT,:IfSuccess_,BIGINT,:Device_,BIGINT,:ClientVersion_,BIGINT,:\
ClientIP_,BIGINT,:AgentIP_,BIGINT,:TimeStamp_,BIGINT,:ExpandCol1_,BIGINT,:ExpandCol2_,BIGINT,:NetType_,BIGINT,:SignalStrength_,BIGINT,:\
ErrCode_,BIGINT,:AliveTime_,BIGINT
table.zk.servers=xx-xx-xx1:2181,xx-xx-xx2:2181,xx-xx-xx3:2181,xx-xx-xx4:2181,xx-xx-xx5:2181
table.zk.root=/xxxx_xxxxxx
table.topic=cdg_xxxxxxx
table.interfaceId=log_10393

table.field.splitter=,
table.list.splitter=;
table.map.splitter=:

[tabledesc-log_10392]
table.name=log_10392
table.type=stream
table.fields=LogID_,BIGINT,:ProtocolVersion_,BIGINT,:Uin_,BIGINT,:IfSuccess_,BIGINT,:Device_,BIGINT,:ClientVersion_,BIGINT,:\
ClientIP_,BIGINT,:AgentIP_,BIGINT,:TimeStamp_,BIGINT,:ExpandCol1_,BIGINT,:ExpandCol2_,BIGINT,:AliveTime_,BIGINT,:NetType_,BIGINT,:\
SignalStrength_,BIGINT
table.zk.servers=xx-xx-xx1:2181,xx-xx-xx2:2181,xx-xx-xx3:2181,xx-xx-xx4:2181,xx-xx-xx5:2181
table.zk.root=/xxxx_xxxxxx
table.topic=cdg_xxxxxxx
table.interfaceId=log_10392

table.field.splitter=,
table.list.splitter=;
table.map.splitter=:

[tabledesc-log_10421]
table.name=log_10421
table.type=stream
table.fields=LogID_,BIGINT,:ProtocolVersion_,BIGINT,:Uin_,BIGINT,:IfSuccess_,BIGINT,:Device_,BIGINT,:ClientVersion_,BIGINT,:\
ClientIP_,BIGINT,:AgentIP_,BIGINT,:TimeStamp_,BIGINT,:ExpandCol1_,BIGINT,:ExpandCol2_,BIGINT,:DeviceModel_,STRING,:DeviceBrand_,STRING,:\
OsName_,STRING,:OsVersion_,STRING,:LanguageVersion_,STRING,:StartTime_,BIGINT,:EndTime_,BIGINT,:Count_,BIGINT,:CientErrNo_,BIGINT,:\
OpType_,BIGINT,:OpStartTs_,BIGINT,:OpEndTs_,BIGINT,:NetType_,BIGINT,:FileType_,BIGINT,:FileSize_,BIGINT,:CDNErrNo_,BIGINT,:CDNOpType_,BIGINT,:\
SvrIP_,STRING,:IPCount_,BIGINT,:FileKey_,STRING,:SliceCount_,BIGINT,:TransportSize_,BIGINT,:ConnTotalCost_,BIGINT,:ConnTryTimes_,BIGINT,:\
CDNTransfStartTs_,BIGINT,:CDNTransfEndTs_,BIGINT,:IsHitCache_,BIGINT,:CompressPicLevel_,BIGINT
table.zk.servers=xx-xx-xx1:2181,xx-xx-xx2:2181,xx-xx-xx3:2181,xx-xx-xx4:2181,xx-xx-xx5:2181
table.zk.root=/xxxx_xxxxxx
table.topic=cdg_xxxxxxx
table.interfaceId=log_10421

table.field.splitter=,
table.list.splitter=;
table.map.splitter=:



[tabledesc-tde]
table.name=ip_table
table.type=tde
table.fields=ipint,string,:country_id,string,:province_name,string,:isp_name,string,:city_name,string,:\
country_name,string,:province_id,string,:city_id,string,:isp_id,string,

table.field.splitter=,

table.tde.master=xx.xxx.xxx.xxx:5198
table.tde.slave=xx.xxx.xxx.xxx:5198
table.tde.groupname=xxxxxx_tdengine
table.tde.tid=xxxx
table.tde.timeout=5000

[tabledesc-meta]
table.name=weixin_res_meta
table.type=stream
table.fields=statDate,string,:device,string,:country,string,:cnt,bigint,:avgTime,double,
table.zk.servers=xx-xx-xx1:2181,xx-xx-xx2:2181,xx-xx-xx3:2181,xx-xx-xx4:2181,xx-xx-xx5:2181
table.zk.root=/xxxx
table.topic=xxxxxxxxx
table.interfaceId=1
table.field.splitter=,
table.list.splitter=;
table.map.splitter=:





